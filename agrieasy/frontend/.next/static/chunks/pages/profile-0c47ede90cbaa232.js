(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{6896:function(e,l,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return o(1109)}])},1109:function(e,l,o){"use strict";o.r(l),o.d(l,{default:function(){return r}});var n=o(5893),i=o(7294),s=o(3700),d=o(1163),a=o(8937);function r(){var e,l,o,r,t,u,c,m,v,h,x,p,g,f,j,b,N,w,y,C,L,D,k,P,S,E;let{user:A,token:B,setToken:M,setUser:_}=(0,s.a)(),U=(0,d.useRouter)(),[F,W]=(0,i.useState)(null),[T,z]=(0,i.useState)(!0),[I,O]=(0,i.useState)(!1),[H,R]=(0,i.useState)(null),[V,q]=(0,i.useState)({name:"",email:"",phone:""}),[J,X]=(0,i.useState)({name:"",email:"",phone:""});(0,i.useEffect)(()=>{if(!B){U.push("/login");return}Y()},[B,U]),(0,i.useEffect)(()=>{Y()},[A]),(0,i.useEffect)(()=>{A&&console.log("\uD83C\uDFAF Profile: Current user data from AuthContext:",{id:A.id,name:A.name,email:A.email,phone:A.phone,role:A.role,token:B?"present":"missing"})},[A,B]);let Y=async()=>{try{if(console.log("\uD83D\uDCCB Profile: Loading profile, user:",A),console.log("\uD83D\uDCCB Profile: Current token:",B?"present":"missing"),A){let e={id:A.id||"",name:A.name||"",email:A.email||"",phone:A.phone||"",role:A.role||"",createdAt:A.createdAt||new Date().toISOString()};console.log("\uD83D\uDCCB Profile: Setting profile data:",e),W(e),q({name:A.name||"",email:A.email||"",phone:A.phone||""}),console.log("\uD83D\uDCCB Profile: Set profile from user:",A)}else console.log("\uD83D\uDCCB Profile: No user available")}catch(e){console.error("\uD83D\uDCCB Profile: Failed to load profile:",e)}z(!1)},G=()=>{let e={name:"",email:"",phone:""},l=!0;return V.name.trim()||(e.name="Name is required",l=!1),V.email.trim()?V.email.includes("@")||(e.email="Please enter a valid email address",l=!1):(e.email="Email is required",l=!1),V.phone.trim()?V.phone.trim().length<10&&(e.phone="Please enter a valid phone number",l=!1):(e.phone="Phone number is required",l=!1),X(e),l},K=async e=>{if(e.preventDefault(),G()){O(!0),R(null);try{(await (0,a.h)("/users/profile",{method:"PATCH",body:JSON.stringify({name:V.name,email:V.email,phone:V.phone})},B||void 0)).success&&(_({...A,name:V.name,email:V.email,phone:V.phone}),W({...F,name:V.name,email:V.email,phone:V.phone}),R({type:"success",text:"Profile updated successfully!"}))}catch(e){R({type:"error",text:(null==e?void 0:e.message)||"Failed to update profile"})}O(!1)}},Q=()=>{localStorage.clear(),sessionStorage.clear(),M(null),_(null),window.location.href="/auth/signin"},Z=(e,l)=>{q(o=>({...o,[e]:l})),J[e]&&X(l=>({...l,[e]:""}))};return B?T?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto px-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,n.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-6",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Profile Settings"}),(0,n.jsx)("p",{className:"text-green-100",children:"Manage your account information"})]}),(0,n.jsx)("button",{onClick:Q,className:"px-4 py-2 rounded-lg transition-colors text-sm font-medium ".concat((null==F?void 0:null===(e=F.name)||void 0===e?void 0:e.toLowerCase().includes("demo"))||(null==F?void 0:null===(l=F.name)||void 0===l?void 0:l.toLowerCase().includes("test"))||(null==F?void 0:null===(o=F.name)||void 0===o?void 0:o.toLowerCase().includes("user"))||(null==F?void 0:null===(r=F.name)||void 0===r?void 0:r.toLowerCase().includes("sample"))||(null==F?void 0:null===(t=F.email)||void 0===t?void 0:t.toLowerCase().includes("demo"))||(null==F?void 0:null===(u=F.email)||void 0===u?void 0:u.toLowerCase().includes("example"))||(null==F?void 0:null===(c=F.email)||void 0===c?void 0:c.toLowerCase().includes("test"))||(null==F?void 0:null===(m=F.email)||void 0===m?void 0:m.toLowerCase().includes("sample"))||(null==F?void 0:null===(v=F.phone)||void 0===v?void 0:v.includes("9876543210"))||(null==F?void 0:null===(h=F.phone)||void 0===h?void 0:h.includes("1234567890"))||(null==F?void 0:null===(x=F.phone)||void 0===x?void 0:x.includes("0000000000"))||(null==F?void 0:null===(p=F.email)||void 0===p?void 0:p.includes("agrihub.com"))&&(null==F?void 0:null===(g=F.name)||void 0===g?void 0:g.includes("System"))||(null==F?void 0:F.name)==="Demo User"||(null==F?void 0:F.email)==="demo@example.com"||(null==F?void 0:F.phone)==="+91 9876543210"?"bg-red-600 hover:bg-red-700 text-white":"bg-white/20 hover:bg-white/30 text-white"),children:(null==F?void 0:null===(f=F.name)||void 0===f?void 0:f.toLowerCase().includes("demo"))||(null==F?void 0:null===(j=F.name)||void 0===j?void 0:j.toLowerCase().includes("test"))||(null==F?void 0:null===(b=F.name)||void 0===b?void 0:b.toLowerCase().includes("user"))||(null==F?void 0:null===(N=F.name)||void 0===N?void 0:N.toLowerCase().includes("sample"))||(null==F?void 0:null===(w=F.email)||void 0===w?void 0:w.toLowerCase().includes("demo"))||(null==F?void 0:null===(y=F.email)||void 0===y?void 0:y.toLowerCase().includes("example"))||(null==F?void 0:null===(C=F.email)||void 0===C?void 0:C.toLowerCase().includes("test"))||(null==F?void 0:null===(L=F.email)||void 0===L?void 0:L.toLowerCase().includes("sample"))||(null==F?void 0:null===(D=F.phone)||void 0===D?void 0:D.includes("9876543210"))||(null==F?void 0:null===(k=F.phone)||void 0===k?void 0:k.includes("1234567890"))||(null==F?void 0:null===(P=F.phone)||void 0===P?void 0:P.includes("0000000000"))||(null==F?void 0:null===(S=F.email)||void 0===S?void 0:S.includes("agrihub.com"))&&(null==F?void 0:null===(E=F.name)||void 0===E?void 0:E.includes("System"))||(null==F?void 0:F.name)==="Demo User"||(null==F?void 0:F.email)==="demo@example.com"||(null==F?void 0:F.phone)==="+91 9876543210"?"\uD83D\uDEA8 Fix Demo Data - Logout":"Logout"})]})}),(0,n.jsxs)("form",{onSubmit:K,className:"p-6",children:[H&&(0,n.jsxs)("div",{className:"mb-6 p-4 rounded-lg flex items-center space-x-3 ".concat("success"===H.type?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:["success"===H.type?(0,n.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):(0,n.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,n.jsx)("span",{children:H.text})]}),(0,n.jsx)("div",{className:"mb-6 p-4 rounded-lg bg-gray-50 text-gray-700 border border-gray-200",children:(0,n.jsxs)("details",{className:"text-sm",children:[(0,n.jsx)("summary",{className:"cursor-pointer font-medium",children:"Debug Information (Click to expand)"}),(0,n.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"User ID:"})," ",(null==F?void 0:F.id)||"Not available"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Token Status:"})," ",B?"Valid":"Missing"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Data Source:"})," ",A?"JWT Token":"API Call"]}),(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Raw Data:"})}),(0,n.jsx)("pre",{className:"text-xs bg-gray-100 p-2 rounded overflow-x-auto",children:JSON.stringify({id:null==F?void 0:F.id,name:null==F?void 0:F.name,email:null==F?void 0:F.email,phone:null==F?void 0:F.phone,role:null==F?void 0:F.role},null,2)})]})]})}),(()=>{var e,l,o,i,s,d,a,r,t,u,c,m,v,h,x,p,g,f,j,b,N,w;let y=(null==F?void 0:null===(e=F.name)||void 0===e?void 0:e.toLowerCase().includes("demo"))||(null==F?void 0:null===(l=F.name)||void 0===l?void 0:l.toLowerCase().includes("test"))||(null==F?void 0:null===(o=F.name)||void 0===o?void 0:o.toLowerCase().includes("user"))||(null==F?void 0:null===(i=F.name)||void 0===i?void 0:i.toLowerCase().includes("sample"))||(null==F?void 0:null===(s=F.email)||void 0===s?void 0:s.toLowerCase().includes("demo"))||(null==F?void 0:null===(d=F.email)||void 0===d?void 0:d.toLowerCase().includes("example"))||(null==F?void 0:null===(a=F.email)||void 0===a?void 0:a.toLowerCase().includes("test"))||(null==F?void 0:null===(r=F.email)||void 0===r?void 0:r.toLowerCase().includes("sample"))||(null==F?void 0:null===(t=F.phone)||void 0===t?void 0:t.includes("9876543210"))||(null==F?void 0:null===(u=F.phone)||void 0===u?void 0:u.includes("1234567890"))||(null==F?void 0:null===(c=F.phone)||void 0===c?void 0:c.includes("0000000000"))||(null==F?void 0:null===(m=F.email)||void 0===m?void 0:m.includes("agrihub.com"))&&(null==F?void 0:null===(v=F.name)||void 0===v?void 0:v.includes("System"))||(null==F?void 0:F.name)==="Demo User"||(null==F?void 0:F.email)==="demo@example.com"||(null==F?void 0:F.phone)==="+91 9876543210";return console.log("\uD83D\uDEA8 Profile: Demo data detection result:",{profileData:{name:null==F?void 0:F.name,email:null==F?void 0:F.email,phone:null==F?void 0:F.phone,role:null==F?void 0:F.role},detectionPatterns:{nameDemo:null==F?void 0:null===(h=F.name)||void 0===h?void 0:h.toLowerCase().includes("demo"),nameTest:null==F?void 0:null===(x=F.name)||void 0===x?void 0:x.toLowerCase().includes("test"),nameUser:null==F?void 0:null===(p=F.name)||void 0===p?void 0:p.toLowerCase().includes("user"),emailDemo:null==F?void 0:null===(g=F.email)||void 0===g?void 0:g.toLowerCase().includes("demo"),emailExample:null==F?void 0:null===(f=F.email)||void 0===f?void 0:f.toLowerCase().includes("example"),phone987:null==F?void 0:null===(j=F.phone)||void 0===j?void 0:j.includes("9876543210"),phone123:null==F?void 0:null===(b=F.phone)||void 0===b?void 0:b.includes("1234567890"),exactName:(null==F?void 0:F.name)==="Demo User",exactEmail:(null==F?void 0:F.email)==="demo@example.com",exactPhone:(null==F?void 0:F.phone)==="+91 9876543210",agrihubSystem:(null==F?void 0:null===(N=F.email)||void 0===N?void 0:N.includes("agrihub.com"))&&(null==F?void 0:null===(w=F.name)||void 0===w?void 0:w.includes("System"))},isDemoData:y}),y?(0,n.jsx)("div",{className:"mb-6 p-4 rounded-lg bg-red-50 text-red-800 border border-red-200",children:(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:"\uD83D\uDEA8 Demo Data Detected!"}),(0,n.jsxs)("p",{className:"text-sm",children:["You are logged in with demo/test data. Your profile shows: ",(0,n.jsx)("strong",{children:null==F?void 0:F.name})," (",null==F?void 0:F.email,")"]}),(0,n.jsx)("p",{className:"text-sm",children:"Click below to logout and login with your real account."}),(0,n.jsx)("button",{onClick:Q,className:"mt-3 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-medium transition-colors",children:"\uD83D\uDEAA Logout & Login with Real Account"})]})]})}):null})(),F&&(0,n.jsxs)("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Current Information"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Name"}),(0,n.jsx)("p",{className:"font-medium",children:F.name||"Not provided"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,n.jsx)("p",{className:"font-medium",children:F.email||"Not provided"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,n.jsx)("p",{className:"font-medium",children:F.phone||"Not provided"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-xs font-bold text-green-600",children:F.role.charAt(0)})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Role"}),(0,n.jsx)("p",{className:"font-medium",children:F.role})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold",children:"Update Information"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name *"}),(0,n.jsx)("input",{type:"text",value:V.name,onChange:e=>Z("name",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 ".concat(J.name?"border-red-300":"border-gray-300"),placeholder:"Enter your full name"}),J.name&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.name})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),(0,n.jsx)("input",{type:"email",value:V.email,onChange:e=>Z("email",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 ".concat(J.email?"border-red-300":"border-gray-300"),placeholder:"Enter your email address"}),J.email&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.email})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number *"}),(0,n.jsx)("input",{type:"tel",value:V.phone,onChange:e=>Z("phone",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 ".concat(J.phone?"border-red-300":"border-gray-300"),placeholder:"Enter your phone number"}),J.phone&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.phone})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>U.back(),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,n.jsx)("button",{type:"submit",disabled:I,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:I?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,n.jsx)("span",{children:"Updating..."})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),(0,n.jsx)("span",{children:"Update Profile"})]})})]})]})]})]})})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Please Login"}),(0,n.jsx)("button",{onClick:()=>U.push("/login"),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700",children:"Go to Login"})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6896)}),_N_E=e.O()}]);