(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[262],{1548:function(e,n,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login-new",function(){return l(8007)}])},8007:function(e,n,l){"use strict";l.r(n),l.d(n,{default:function(){return r}});var s=l(5893),a=l(7294),t=l(3700),o=l(1163);function r(){let[e,n]=(0,a.useState)("phone"),[l,r]=(0,a.useState)(""),[i,d]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[h,g]=(0,a.useState)("phone"),[p,x]=(0,a.useState)(""),[m,b]=(0,a.useState)("CONSUMER"),[f,j]=(0,a.useState)(null),[N,v]=(0,a.useState)(null),[P,y]=(0,a.useState)(!1),{setToken:T}=(0,t.a)(),w=(0,o.useRouter)(),O=async()=>{console.log("Requesting OTP..."),v(null),y(!0);try{let n="email"===e?i:l;console.log("Sending OTP request for:",{[e]:n}),console.log("Using mock OTP response"),j("123456"),g("otp"),console.log("Mock OTP set, moving to OTP stage")}catch(e){console.error("OTP Request Error:",e),v("Failed to send OTP. Please try again.")}finally{y(!1)}},E=async()=>{console.log("Verifying OTP..."),v(null),y(!0);try{let n="email"===e?i:l;console.log("Verifying OTP:",{[e]:n,otp:c,name:p,role:m}),console.log("Using mock verification"),T("mock-jwt-token"),console.log("Mock token set, redirecting to dashboard"),w.push("/dashboard")}catch(e){console.error("OTP Verification Error:",e),v("Invalid OTP. Please try again.")}finally{y(!1)}};return(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white p-6 rounded shadow",children:[N&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:N}),"phone"===h?(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Login with OTP"}),(0,s.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,s.jsx)("button",{onClick:()=>n("phone"),className:"".concat("phone"===e?"bg-agrigreen text-white":"bg-gray-200"," px-3 py-2 rounded"),disabled:P,children:"Phone"}),(0,s.jsx)("button",{onClick:()=>n("email"),className:"".concat("email"===e?"bg-agrigreen text-white":"bg-gray-200"," px-3 py-2 rounded"),disabled:P,children:"Email"})]}),"phone"===e?(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Enter phone number",value:l,onChange:e=>r(e.target.value),disabled:P}):(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Enter email",value:i,onChange:e=>d(e.target.value),disabled:P}),(0,s.jsx)("button",{onClick:O,className:"bg-agrigreen text-white px-4 py-2 rounded w-full ".concat(P?"opacity-50":""),disabled:P,children:P?"Sending...":"Request OTP"}),(0,s.jsxs)("div",{className:"mt-4 p-3 bg-gray-100 text-xs text-gray-600 rounded",children:[(0,s.jsx)("p",{children:"Debug Info:"}),(0,s.jsxs)("p",{children:["Mode: ",e]}),(0,s.jsxs)("p",{children:["Stage: ",h]}),(0,s.jsxs)("p",{children:["Loading: ",P?"Yes":"No"]}),f&&(0,s.jsxs)("p",{children:["Server OTP: ",f]})]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Enter OTP"}),f&&(0,s.jsx)("div",{className:"mb-4 p-2 bg-yellow-100 text-yellow-800 text-sm rounded",children:(0,s.jsxs)("p",{children:["For testing, use this OTP: ",(0,s.jsx)("span",{className:"font-mono font-bold",children:f})]})}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Enter OTP",value:c,onChange:e=>u(e.target.value),disabled:P}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Your name",value:p,onChange:e=>x(e.target.value),disabled:P}),(0,s.jsxs)("select",{className:"border p-2 w-full mb-3",value:m,onChange:e=>b(e.target.value),disabled:P,children:[(0,s.jsx)("option",{value:"FARMER",children:"Farmer"}),(0,s.jsx)("option",{value:"EQUIPMENT_VENDOR",children:"Equipment Vendor"}),(0,s.jsx)("option",{value:"INPUT_SUPPLIER",children:"Input Supplier"}),(0,s.jsx)("option",{value:"TRANSPORTER",children:"Transporter"}),(0,s.jsx)("option",{value:"CONSUMER",children:"Consumer"}),(0,s.jsx)("option",{value:"ADMIN",children:"Admin"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>g("phone"),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded",disabled:P,children:"Back"}),(0,s.jsx)("button",{onClick:E,className:"flex-1 bg-agrigreen text-white px-4 py-2 rounded ".concat(P?"opacity-50":""),disabled:P||!c||!p,children:P?"Verifying...":"Verify OTP"})]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=1548)}),_N_E=e.O()}]);