(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{2120:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/signup",function(){return a(31)}])},31:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var s=a(5893),n=a(7294),l=a(1163),r=a(8937),o=a(3700);function i(){let e=(0,l.useRouter)(),{setToken:t,token:a}=(0,o.a)(),i=e.query.phone||"",u=e.query.email||"",d=(0,n.useMemo)(()=>!!u,[u]),[c,h]=(0,n.useState)(""),[m,p]=(0,n.useState)(null),[x,f]=(0,n.useState)(""),[g,y]=(0,n.useState)("CONSUMER"),[b,w]=(0,n.useState)(!1),[N,v]=(0,n.useState)(null),[S,j]=(0,n.useState)("otp"),[P,C]=(0,n.useState)(""),[O,E]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{if(i||u)try{if((await (0,r.h)("/auth/check-user",{method:"POST",body:JSON.stringify(d?{email:u}:{phone:i})})).exists){let t=d?"email=".concat(encodeURIComponent(u)):"phone=".concat(encodeURIComponent(i));e.replace("/auth/signin?".concat(t))}}catch(e){}})()},[i,u,d,e]),(0,n.useEffect)(()=>{(i||u)&&T()},[i,u]);let T=async()=>{v(null),w(!0);try{let e=d?{email:u}:{phone:i},t=await (0,r.h)("/auth/request-otp",{method:"POST",body:JSON.stringify(e)});p(t.otp||null),j("otp")}catch(e){v((null==e?void 0:e.message)||"Could not request OTP")}finally{w(!1)}},_=async()=>{v(null),w(!0);try{let a=d?{email:u,otp:c,name:x,role:g}:{phone:i,otp:c,name:x,role:g},s=await (0,r.h)("/auth/verify-otp",{method:"POST",body:JSON.stringify(a)});t(s.token),s.needsPassword?j("setpw"):e.push("/dashboard")}catch(e){v((null==e?void 0:e.message)||"OTP verification failed")}finally{w(!1)}},R=async()=>{if(v(null),P.length<8){v("Password must be at least 8 characters");return}if(P!==O){v("Passwords do not match");return}w(!0);try{await (0,r.h)("/auth/set-password",{method:"POST",body:JSON.stringify({newPassword:P})},a||void 0),e.push("/dashboard")}catch(e){v((null==e?void 0:e.message)||"Could not set password")}finally{w(!1)}};return(0,s.jsxs)("div",{className:"max-w-md mx-auto bg-white p-6 rounded shadow mt-8",children:["otp"===S?(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Sign Up"}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:d?"Email: ".concat(u):"Phone: ".concat(i)}),(0,s.jsxs)("div",{className:"mb-2 text-sm text-gray-600",children:["OTP sent to your ",d?"email":"phone"]}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Enter OTP",value:c,onChange:e=>h(e.target.value)}),(0,s.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Full Name",value:x,onChange:e=>f(e.target.value)}),(0,s.jsxs)("select",{className:"border p-2 w-full mb-3",value:g,onChange:e=>y(e.target.value),children:[(0,s.jsx)("option",{value:"FARMER",children:"Farmer"}),(0,s.jsx)("option",{value:"EQUIPMENT_VENDOR",children:"Equipment Vendor"}),(0,s.jsx)("option",{value:"INPUT_SUPPLIER",children:"Input Supplier"}),(0,s.jsx)("option",{value:"TRANSPORTER",children:"Transporter"}),(0,s.jsx)("option",{value:"CONSUMER",children:"Consumer"}),(0,s.jsx)("option",{value:"ADMIN",children:"Admin"})]}),(0,s.jsx)("button",{onClick:_,disabled:b,className:"px-4 py-2 rounded w-full ".concat(b?"bg-gray-400":"bg-primary-green text-white"),children:b?"Verifying...":"Verify OTP"}),(0,s.jsx)("button",{onClick:T,disabled:b,className:"mt-2 w-full px-4 py-2 rounded bg-gray-200 text-gray-800",children:"Resend OTP"}),N&&(0,s.jsx)("div",{className:"mt-3 text-sm text-red-600",children:N})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Create Password"}),(0,s.jsx)("input",{type:"password",className:"border p-2 w-full mb-3",placeholder:"Password (min 8 chars)",value:P,onChange:e=>C(e.target.value)}),(0,s.jsx)("input",{type:"password",className:"border p-2 w-full mb-3",placeholder:"Confirm Password",value:O,onChange:e=>E(e.target.value)}),(0,s.jsx)("button",{onClick:R,disabled:b,className:"px-4 py-2 rounded w-full ".concat(b?"bg-gray-400":"bg-primary-green text-white"),children:b?"Saving...":"Save & Continue"}),N&&(0,s.jsx)("div",{className:"mt-3 text-sm text-red-600",children:N})]}),(0,s.jsxs)("div",{className:"mt-4 text-sm",children:["Existing user? ",(0,s.jsx)("button",{className:"underline text-primary-green",onClick:()=>e.push("/auth/signin"),children:"Go to Sign In"})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=2120)}),_N_E=e.O()}]);