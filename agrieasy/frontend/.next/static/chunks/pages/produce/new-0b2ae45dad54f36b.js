(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[438],{6605:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/produce/new",function(){return t(9055)}])},9055:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return i}});var r=t(5893),l=t(7294),u=t(3700),n=t(8937);function i(){let{token:e,user:a}=(0,u.a)(),[t,i]=(0,l.useState)(""),[o,s]=(0,l.useState)(20),[d,c]=(0,l.useState)(50),[m,p]=(0,l.useState)(null),[f,b]=(0,l.useState)(null),[h,w]=(0,l.useState)(!1),g=async()=>{if(!m)return null;let a=new FormData;a.append("image",m);try{return(await (0,n.h)("/produce/upload-image",{method:"POST",body:a},e)).imageUrl}catch(e){return alert("Image upload failed"),null}},N=async()=>{if(!e)return alert("Login required");if((null==a?void 0:a.role)!=="FARMER")return alert("Farmer role required");w(!0);let r=await g();if(!r&&m){w(!1);return}try{await (0,n.h)("/produce",{method:"POST",body:JSON.stringify({name:t,price:o,stock:d,imageUrl:r})},e),alert("Produce listed"),i(""),s(20),c(50),p(null),b(null)}catch(e){alert("Failed to list produce")}finally{w(!1)}};return(0,r.jsxs)("div",{className:"max-w-md mx-auto bg-white p-6 rounded shadow",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold mb-4",children:"List Produce"}),(0,r.jsx)("input",{className:"border p-2 w-full mb-3",placeholder:"Name",value:t,onChange:e=>i(e.target.value)}),(0,r.jsx)("input",{type:"number",className:"border p-2 w-full mb-3",placeholder:"Price",value:o,onChange:e=>s(Number(e.target.value))}),(0,r.jsx)("input",{type:"number",className:"border p-2 w-full mb-3",placeholder:"Stock",value:d,onChange:e=>c(Number(e.target.value))}),(0,r.jsx)("input",{type:"file",accept:"image/*",className:"border p-2 w-full mb-3",onChange:e=>{var a;let t=null===(a=e.target.files)||void 0===a?void 0:a[0];if(t){p(t);let e=new FileReader;e.onload=()=>b(e.result),e.readAsDataURL(t)}}}),f&&(0,r.jsx)("img",{src:f,alt:"Preview",className:"w-full h-48 object-cover mb-3 rounded"}),(0,r.jsx)("button",{onClick:N,disabled:h,className:"px-4 py-2 rounded w-full ".concat(h?"bg-gray-400":"bg-primary-green text-white"),children:h?"Creating...":"Create"})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6605)}),_N_E=e.O()}]);